language: node_js

node_js:
  - 7.4.0

branches:
  only:
    - master

before_deploy:
  - terraform_url=$(curl https://releases.hashicorp.com/index.json | jq '{terraform}' | egrep "linux.*amd64" | sort --version-sort -r | head -1 | awk -F[\"] '{print $4}')
  - curl -o terraform.zip $terraform_url
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip

deploy:
  provider: script
  script: make deploy
  on:
    branch: master
env:
  global:
    - secure: QjnUMgmHCHimV8eX5j2jMkVPiYszUOtKq/4g7iqtgxRATEi3mSXV3peidH1xLuF86Zz+hry1DJiODWodnwz5bJLoL+J5gsZUs3GSjANuRUY5+klwmt3e1vtxQ9AeL3uwrAqQOQVGloIj7Qpg+ZdR4eAvQ16jdfbHEaHUEAArPtTvYZQMnQypT7+gtDoLhkfzJSzMbT6l0g+Rg245sFMH/L/74ojRmmBoJAR5nm/scAvS3E1WYnEgJMrvBn92/NOppyK02YZgXZ4LiXFgeM2FBEzm11CkROTX6gKvEeMBtmlqagsskpSNS0+h7g5E0t3NmYeyBoWGbf35CHiS0lJ3mFKP3L2I7VESbkYMg41YwK+3o0iFOKXa1XbWO7MbNa8Q2/fyNQ+aM0uOLj0kK5qwljjx20USkThmK/kAWml/8Q+r8VfJqW7ZH0iaUQ3MCvkjG7UzPz2+5ivh2T2pz50F57Ps+YLZTQfb4tpu926T/oeODziURXoQwo4NWIHDw6JHQKEKzWsljkexg8AFIP/f5ZZ+28Va500zBc2cRDJI43pqePlkiVnjxi0/z3RxfZuf0QFspgT4dVk0lCmO2ZvHagfRY2vNgJE6Brq3folJXxMJaRFF3S9s1iasN5zE99JVVkH3xF51RtHvlVbwdbXjj92qGX7w+IEwuG+bwhws/bE=
    - secure: AmijW33xSbpM1oxakNEFgk0KQFGc+slF5ioAw2CnENfxQGrKHZv0qM+nCVgH3ExiUgAvZ4fxvW5FETyazieENgIRyOOU4geYkM1mGh/K/wyMglUbRjmp9d5/2f+A1oTK4IV3wgjDiFUperkdd58hm0Uwf6NjRFCwMWYyfAvanrwO+F4lHJuH3+xDUELh9vDcmJGclq2zyUsn+aflOuzut8/UoLirb5wUjptf1wXJUGGD578QoqUAj5rgq34d4plw3HuC9RVsEAxSnf2TQV67mlMSRlVWtHLySITU6vixO98P4shKtWGVa2gLwnh+4BSDqMp1zqCA292VDrUDzuQ4QVRqiXrEv0GEoswfwA5FBK3819Q8esidqRYvv+KuiIXDzMrVDyxZ7JBLVcgcQVAqtizSt/Mp1QHXo14SiR6DwdKb2I4RgTq+jxu5/4utlKH5tatNojEe4Z5oEjeN5YGU64ZejxRS0iVJxYM/4HqqvyWEB6b/sLbkslJP/82rm9SNrHWYDi/gJxX15vOEy3RskmPoZB6ruNTRvZWwIUolT25pMJUEQ9ygQj/9IDY/bqGL9x5bzpIaIc0fADoO8W/5U2Fe20Gx9ITigKSxkNmK15bqRY8REZ2U3Y/fyuurRtgc+nnYO09NbdMq8YjdR5t6JScR3PnqG93y6gbblAH+NNA=