language: node_js

node_js:
  - 7.4.0

branches:
  only:
    - master

before_deploy:
  - terraform_url=$(curl https://releases.hashicorp.com/index.json | jq '{terraform}' | egrep "linux.*amd64" | sort --version-sort -r | head -1 | awk -F[\"] '{print $4}')
  - curl -o terraform.zip $terraform_url
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip

deploy:
  provider: script
  script: make deploy
  on:
    branch: master

env:
  global:
    - secure: rTd/prqBksuUkIjjdnkpecIH+5tIF8sqcaXwOfK+AcTcTGUY9/19bhBr9ods9z/5KDkywrU6tHu5SOE4gWjwz04eQ6TpCeqApxAGtFzL6j/xcXDAlTyONFCU8i9qvrilLsUPGikfP3P7Ba8Btc/7TC14weO5H/TrZU1L9mcL3OPX3obGbyvI3S3JnXsloASfnr5otcpWBNDXQ+ObscVACJ/2O+LeaDj7K2Mmd1S2HYoeddmdt1KyQ00FujsCDksBSZYcv7eIyF6Sak44Yu7Y7OtFcups35+E9nabU9AbKsoNnoJ40JNJjM3O1Ulfz0zpqZyWTu5nlHyiZaicq3kEJXypUwSUsXsGduma/J27fgnsOcWDPoycoqfEYztUxvOtlibs+6WOMzz+6naF9dnXgm0pY7yTE+d8WQo9MgXApkvyQ18oB0PL+QXAfhvnpAWFzO7lmmAr6zrdQOamcjwyMYfe3Zzhm87dgLZQ2UsAsIkpP6+3AO+GvA0umZQ+qLm/LHTGl61dwKR+LcD9oSa3aBcrcyTlW6csGr8y3l9KtiyYSujd/bIQdCIBLmzVC5tVtbjtNnv/03zvaNFxyNEjjy3/FLqw4DQtZGy9lARsPkoSfmTevcQeG3ECc4kRwQ1X2ScGXeqj35Qkt05YKVxZwtLEe1wHWcS4LEjoeyOZHiY=
    - secure: i+GrJ0MbyHUTEhTd1D0y+yFuNoXHvq63QmYrl6eHNGtPfMOsc8K5wDfqnepalM8DFzXNND5CCng1rAA1WA0boiMGz8lc0xRnC6Bq6V93XtkzpGDaJZSIk6VNR4RJFrkK8+r44dRYkvkp7yCSS+5rLkU+jvOxsvUyi4bNCqFIKJbc/KIqunrpHWv4eCUf6SKYXCo8rxlIDc/3/+TebBkhXFoXH9l2TrWN3MhXHEVbMlTPld2GIiDyuefm8OzwO1teMCwLZ1H4eMd0QGMfJU5Njce5HNHZ4bCJoVpCWurOwwOPjmmpnXGhrnURl7pEXA4Y6Lp/C2tnC7e51N3HRoVq3xRylcLJeUpbbuR27sxat9wkvfaMCXeMXVMnG8KWgJTIpB2Y/bSiZ3EshStC8845BApwcGyf0VUVtSS+vUdvSQ45tBFJ32j3ojXj7M1nkmMFc/6wo0+uNncS1CZEyVchdXjy/G+vKBVbDCOsvDs6lUb3/y2MTQaG24Cbb4mPnAOOLMxOULwisF0TB30aJ49X2yfyEo0CpIfNPlr1AxMffkqT5xV7TvC1dlxGS/stjoCKunjV6Oh0C5G3AvkRsyYa5mOhjLNHpNK/lSeXFSAMdYj0bX2K1PeywAG0PvjLFDyVhveagmVFPaJjbcRrGYBrNuuAV5uVav0FtohsCOYSKIg=